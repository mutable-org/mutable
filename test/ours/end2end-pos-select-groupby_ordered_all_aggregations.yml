description: Groupby on ordered input with all aggregation functions
db: ours
query: |
    SELECT
        fkey,
        COUNT(),
        MIN(key),
        MAX(key),
        SUM(key),
        AVG(key),
        MIN(rfloat),
        MAX(rfloat),
        SUM(rfloat),
        AVG(rfloat)
    FROM
        (SELECT * FROM R ORDER BY fkey) AS X
    GROUP BY
        fkey
    ORDER BY
        fkey
    ;
required: YES

stages:
    lexer:
        out: |
            -:1:1: SELECT TK_Select
            -:2:5: fkey TK_IDENTIFIER
            -:2:9: , TK_COMMA
            -:3:5: COUNT TK_IDENTIFIER
            -:3:10: ( TK_LPAR
            -:3:11: ) TK_RPAR
            -:3:12: , TK_COMMA
            -:4:5: MIN TK_IDENTIFIER
            -:4:8: ( TK_LPAR
            -:4:9: key TK_IDENTIFIER
            -:4:12: ) TK_RPAR
            -:4:13: , TK_COMMA
            -:5:5: MAX TK_IDENTIFIER
            -:5:8: ( TK_LPAR
            -:5:9: key TK_IDENTIFIER
            -:5:12: ) TK_RPAR
            -:5:13: , TK_COMMA
            -:6:5: SUM TK_IDENTIFIER
            -:6:8: ( TK_LPAR
            -:6:9: key TK_IDENTIFIER
            -:6:12: ) TK_RPAR
            -:6:13: , TK_COMMA
            -:7:5: AVG TK_IDENTIFIER
            -:7:8: ( TK_LPAR
            -:7:9: key TK_IDENTIFIER
            -:7:12: ) TK_RPAR
            -:7:13: , TK_COMMA
            -:8:5: MIN TK_IDENTIFIER
            -:8:8: ( TK_LPAR
            -:8:9: rfloat TK_IDENTIFIER
            -:8:15: ) TK_RPAR
            -:8:16: , TK_COMMA
            -:9:5: MAX TK_IDENTIFIER
            -:9:8: ( TK_LPAR
            -:9:9: rfloat TK_IDENTIFIER
            -:9:15: ) TK_RPAR
            -:9:16: , TK_COMMA
            -:10:5: SUM TK_IDENTIFIER
            -:10:8: ( TK_LPAR
            -:10:9: rfloat TK_IDENTIFIER
            -:10:15: ) TK_RPAR
            -:10:16: , TK_COMMA
            -:11:5: AVG TK_IDENTIFIER
            -:11:8: ( TK_LPAR
            -:11:9: rfloat TK_IDENTIFIER
            -:11:15: ) TK_RPAR
            -:12:1: FROM TK_From
            -:13:5: ( TK_LPAR
            -:13:6: SELECT TK_Select
            -:13:13: * TK_ASTERISK
            -:13:15: FROM TK_From
            -:13:20: R TK_IDENTIFIER
            -:13:22: ORDER TK_Order
            -:13:28: BY TK_By
            -:13:31: fkey TK_IDENTIFIER
            -:13:35: ) TK_RPAR
            -:13:37: AS TK_As
            -:13:40: X TK_IDENTIFIER
            -:14:1: GROUP TK_Group
            -:14:7: BY TK_By
            -:15:5: fkey TK_IDENTIFIER
            -:16:1: ORDER TK_Order
            -:16:7: BY TK_By
            -:17:5: fkey TK_IDENTIFIER
            -:18:1: ; TK_SEMICOL
        err: NULL
        num_err: 0
        returncode: 0

    parser:
        out: |
            SELECT fkey, COUNT(), MIN(key), MAX(key), SUM(key), AVG(key), MIN(rfloat), MAX(rfloat), SUM(rfloat), AVG(rfloat)
            FROM (SELECT *
            FROM R
            ORDER BY fkey ASC) AS X
            GROUP BY fkey
            ORDER BY fkey ASC;
        err: NULL
        num_err: 0
        returncode: 0

    sema:
        out: NULL
        err: NULL
        num_err: 0
        returncode: 0

    end2end:
        cli_args: --insist-no-ternary-logic
        out: |
            1,1,6,6,6,6,6.8028302,6.8028302,6.802830219268799,6.802830219268799
            2,1,61,61,61,61,0.50579,0.50579,0.5057899951934814,0.5057899951934814
            3,1,68,68,68,68,1.80416,1.80416,1.804159998893738,1.804159998893738
            4,2,4,20,24,12,8.0504599,8.5859299,16.63638973236084,8.31819486618042
            5,1,43,43,43,43,8.8942299,8.8942299,8.894229888916016,8.894229888916016
            6,1,77,77,77,77,7.8922701,7.8922701,7.892270088195801,7.892270088195801
            7,4,11,90,252,63,0.75041002,4.5052299,12.96922987699509,3.242307469248772
            9,1,41,41,41,41,1.56533,1.56533,1.565330028533936,1.565330028533936
            10,2,8,31,39,19.5,0.85653001,4.7030702,5.559600174427032,2.779800087213516
            11,3,12,94,141,47,0.65748,9.26367,12.71042990684509,4.236809968948364
            12,3,38,59,147,49,2.348,8.3262796,15.93378973007202,5.311263243357341
            13,1,63,63,63,63,4.52005,4.52005,4.520050048828125,4.520050048828125
            16,1,96,96,96,96,6.2502198,6.2502198,6.250219821929932,6.250219821929932
            18,2,57,85,142,71,2.91272,7.5415101,10.45423007011414,5.227115035057068
            19,1,84,84,84,84,5.48804,5.48804,5.488039970397949,5.488039970397949
            20,1,27,27,27,27,7.4365501,7.4365501,7.436550140380859,7.436550140380859
            21,1,72,72,72,72,8.0132198,8.0132198,8.013219833374023,8.013219833374023
            23,1,80,80,80,80,8.3134499,8.3134499,8.313449859619141,8.313449859619141
            24,2,36,81,117,58.5,0.85613,3.6784101,4.534540057182312,2.267270028591156
            26,1,98,98,98,98,3.4019301,3.4019301,3.401930093765259,3.401930093765259
            27,4,60,92,296,74,3.41732,9.9636497,22.11549973487854,5.528874933719635
            28,1,42,42,42,42,6.4763498,6.4763498,6.476349830627441,6.476349830627441
            29,1,49,49,49,49,8.5601301,8.5601301,8.56013011932373,8.56013011932373
            30,1,14,14,14,14,4.0377598,4.0377598,4.037759780883789,4.037759780883789
            32,2,17,53,70,35,6.6684098,9.05336,15.7217698097229,7.86088490486145
            33,1,97,97,97,97,6.5113001,6.5113001,6.511300086975098,6.511300086975098
            34,1,48,48,48,48,8.2054901,8.2054901,8.205490112304688,8.205490112304688
            35,1,44,44,44,44,1.81489,1.81489,1.814890027046204,1.814890027046204
            36,1,46,46,46,46,4.3811598,4.3811598,4.381159782409668,4.381159782409668
            38,1,93,93,93,93,8.5136204,8.5136204,8.513620376586914,8.513620376586914
            40,1,45,45,45,45,2.5239899,2.5239899,2.523989915847778,2.523989915847778
            41,3,52,64,172,57.33333333333334,6.0829701,7.9614301,21.51921033859253,7.173070112864177
            43,1,39,39,39,39,1.84364,1.84364,1.843639969825745,1.843639969825745
            45,1,3,3,3,3,2.0950699,2.0950699,2.095069885253906,2.095069885253906
            47,4,58,86,293,73.25,1.08346,8.1176901,13.98303997516632,3.49575999379158
            48,2,2,54,56,28,0.78799999,5.7192302,6.507230162620544,3.253615081310272
            49,1,29,29,29,29,8.5344801,8.5344801,8.534480094909668,8.534480094909668
            50,1,78,78,78,78,1.28952,1.28952,1.289520025253296,1.289520025253296
            51,1,23,23,23,23,6.9720802,6.9720802,6.972080230712891,6.972080230712891
            55,3,22,89,145,48.33333333333334,0.01691,9.6078796,15.64931957237422,5.216439857458075
            57,1,1,1,1,1,5.8926601,5.8926601,5.892660140991211,5.892660140991211
            59,1,32,32,32,32,6.9946499,6.9946499,6.994649887084961,6.994649887084961
            60,1,25,25,25,25,6.11274,6.11274,6.112740039825439,6.112740039825439
            65,1,73,73,73,73,1.9390399,1.9390399,1.939039945602417,1.939039945602417
            66,1,82,82,82,82,8.5116596,8.5116596,8.511659622192383,8.511659622192383
            68,1,21,21,21,21,3.3115001,3.3115001,3.311500072479248,3.311500072479248
            69,2,18,62,80,40,0.36028001,2.5065401,2.866820067167282,1.433410033583641
            74,2,5,74,79,39.5,3.99401,4.4890499,8.483059883117676,4.241529941558838
            77,1,55,55,55,55,8.0193195,8.0193195,8.019319534301758,8.019319534301758
            78,1,99,99,99,99,4.1813502,4.1813502,4.181350231170654,4.181350231170654
            79,2,30,40,70,35,2.25687,5.3412399,7.59810996055603,3.799054980278015
            80,1,87,87,87,87,1.82278,1.82278,1.822780013084412,1.822780013084412
            81,2,0,7,7,3.5,1.11331,5.0766301,6.189940094947815,3.094970047473907
            83,1,16,16,16,16,5.2894101,5.2894101,5.28941011428833,5.28941011428833
            84,1,67,67,67,67,4.8218899,4.8218899,4.821889877319336,4.821889877319336
            85,2,9,10,19,9.5,4.8541398,6.4987798,11.35291957855225,5.676459789276123
            86,3,24,91,185,61.66666666666666,2.1370101,6.7848601,13.42110013961792,4.473700046539307
            88,2,28,33,61,30.5,1.5280499,8.3057203,9.833770275115967,4.916885137557983
            89,1,26,26,26,26,5.1795802,5.1795802,5.179580211639404,5.179580211639404
            90,1,71,71,71,71,2.30111,2.30111,2.301110029220581,2.301110029220581
            91,3,13,51,111,37,2.9186201,8.8743896,16.65971994400024,5.553239981333415
            92,1,69,69,69,69,3.24383,3.24383,3.243829965591431,3.243829965591431
            95,2,19,37,56,28,1.54553,5.50388,7.049409985542297,3.524704992771149
            96,1,15,15,15,15,9.3573399,9.3573399,9.357339859008789,9.357339859008789
            98,1,95,95,95,95,9.6626501,9.6626501,9.662650108337402,9.662650108337402
            99,1,88,88,88,88,0.47804001,0.47804001,0.4780400097370148,0.4780400097370148
        err: NULL
        num_err: 0
        returncode: 0
